permissions:
  contents: read
name: Test Workflows

on:
  push:
    branches: [main]
    paths:
      - '**.yaml'
      - '**.yml'
  pull_request:
    paths:
      - '**.yaml'
      - '**.yml'
  workflow_dispatch:

jobs:         
  test-with-mock-package:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create mock R package
        run: |
          mkdir -p R
          mkdir -p man
          mkdir -p tests/testthat
          
          # Create minimal R package structure
          echo 'Package: mockpkg
          Version: 0.1.0
          Title: Mock Package for Testing Workflows
          Description: A minimal package to test GitHub Actions workflows.
          Authors@R: person("Test", "User", email = "test@example.com", role = c("aut", "cre"))
          License: MIT
          Encoding: UTF-8
          Roxygen: list(markdown = TRUE)
          RoxygenNote: 7.2.0' > DESCRIPTION
          
          # Create a simple R function with roxygen
          echo "#' Add two numbers
          #'
          #' @param x A number
          #' @param y A number
          #' @return The sum of x and y
          #' @export
          add <- function(x, y) {
            x + y
          }" > R/add.R
          
          # Create a simple test
          echo "test_that(\"addition works\", {
            expect_equal(add(2, 2), 4)
          })" > tests/testthat/test-add.R

          
      - name: Test phs_package_checks workflows
        uses: ./.github/workflows/phs_package_checks.yaml@${{ inputs.branch }}
